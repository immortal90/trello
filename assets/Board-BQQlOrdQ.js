import{r as a,j as e,B as g,u as T}from"./index-BSmJBPnd.js";import{B as L,v as y,c as k,i as C}from"./colorImages-dxv912c7.js";const E=({onAddList:s})=>{const[o,d]=a.useState(""),i=()=>{y(o)&&(s(o),d(""))};return e.jsxs("div",{className:"addListForm",children:[e.jsx("input",{className:"input",type:"text",placeholder:"Введіть назву нового списку",value:o,onChange:u=>d(u.target.value)}),e.jsx("div",{className:"button",children:e.jsx(L,{onClick:i,children:"Додати новий список"})})]})},B=/^[a-zA-Z0-9а-яА-Яії _.-]+$/,A=({card:s,fetchBoardData:o,boardId:d,listId:i})=>{const[u,h]=a.useState(!1),[l,b]=a.useState(s.title),[x,p]=a.useState(s.description),[c,f]=a.useState(s.color),[j,m]=a.useState(null),[r,N]=a.useState(0),S=()=>{r<100&&N(n=>n+10)},t=n=>{const w=k.find($=>$.color===n);return w?w.base64:null},v=async()=>{if(!B.test(l)){g.error("Заголовок картки містить недопустимі символи.");return}try{await C.put(`/board/${d}/card/${s.id}`,{title:l,description:x,color:c,list_id:i}),h(!1),m(null),o()}catch{g.error("Сталася помилка при збереженні картки.")}};return e.jsxs("div",{className:"card",style:{backgroundImage:`url(${t(c)})`,backgroundSize:"cover"},children:[e.jsx("div",{className:"progress-bar",children:e.jsx("div",{className:"progress",style:{width:`${r}%`}})}),u?e.jsxs("div",{className:"card-edit",children:[j&&e.jsx("p",{className:"error-message",children:j}),e.jsx("input",{type:"text",value:l,onChange:n=>b(n.target.value),placeholder:"Заголовок картки"}),e.jsx("textarea",{value:x,onChange:n=>p(n.target.value),placeholder:"Опис картки"}),e.jsxs("div",{className:"color-picker",children:[e.jsx("label",{children:"Колір:"}),e.jsx("div",{className:"color-options",children:k.map(n=>e.jsx("button",{style:{backgroundColor:n.color,border:c===n.color?"2px solid black":"none"},onClick:()=>f(n.color)},n.color))})]}),e.jsxs("div",{className:"card-edit-buttons",children:[e.jsx("button",{onClick:v,children:"Зберегти"}),e.jsx("button",{onClick:()=>h(!1),children:"Скасувати"})]})]}):e.jsxs("div",{className:"card-view",onClick:()=>h(!0),children:[e.jsx("h5",{children:s.title}),e.jsx("p",{children:s.description})]}),e.jsx("button",{onClick:S,children:"Збільшити прогрес"})]})},F=/^[a-zA-Z0-9а-яА-Яії _.-]+$/,_=({boardId:s,listId:o,fetchBoardData:d})=>{const[i,u]=a.useState(""),[h,l]=a.useState(1),[b,x]=a.useState(""),[p,c]=a.useState(""),[f,j]=a.useState("#ffffff"),m=async()=>{if(!i){g.error("Будь ласка, введіть заголовок картки.");return}if(!F.test(i)){g.error("Заголовок картки може містити тільки букви, цифри, пробіли, дефіси та крапки.");return}try{const r=await C.post(`/board/${s}/card`,{title:i,list_id:o,position:h,description:b,custom:p?JSON.parse(p):void 0,color:f});console.log("Картка додана:",r.data),d(),u(""),l(1),x(""),c(""),j("#ffffff")}catch{g.error("Сталася помилка при додаванні картки. Спробуйте ще раз.")}};return e.jsxs("div",{className:"addCardForm",children:[e.jsx("h5",{children:"Додати нову картку"}),e.jsxs("form",{onSubmit:r=>r.preventDefault(),children:[e.jsxs("div",{children:[e.jsx("label",{children:"Заголовок картки:"}),e.jsx("input",{type:"text",value:i,onChange:r=>u(r.target.value),placeholder:"Введіть заголовок",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{children:"Позиція:"}),e.jsx("input",{type:"number",value:h,onChange:r=>l(Number(r.target.value)),placeholder:"Введіть позицію",min:1,required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{children:"Опис:"}),e.jsx("textarea",{value:b,onChange:r=>x(r.target.value),placeholder:"Введіть опис"})]}),e.jsxs("div",{children:[e.jsx("label",{children:"Колір:"}),e.jsx("div",{className:"color-options",children:k.map(r=>e.jsx("button",{className:`color-option ${f===r.color?"selected":""}`,style:{backgroundImage:`url(${r.base64})`},onClick:()=>j(r.color),type:"button"},r.color))})]}),e.jsx(L,{onClick:m,children:"Додати картку"})]})]})},D=({boardId:s})=>{const[o,d]=a.useState(""),[i,u]=a.useState([]),[h,l]=a.useState(!0),[b,x]=a.useState(null),[p,c]=a.useState(""),[f,j]=a.useState(!1),m=async()=>{try{const t=await C.get(`/board/${s}`);d(t.title),u(t.lists),l(!1),j(!1)}catch{l(!1),f||j(!0)}};a.useEffect(()=>{m()},[s]);const r=async t=>{if(y(t))try{await C.post(`/board/${s}/list`,{title:t,position:i.length+1}),m()}catch{g.error("Не вдалося додати список.")}},N=(t,v)=>{x(t),c(v)},S=async t=>{if(y(p))try{await C.put(`/board/${s}/list/${t}`,{title:p}),x(null),c("")}catch{g.error("Не вдалося зберегти список.")}};return e.jsx("div",{className:"board-container",children:h?e.jsx("p",{children:"Завантаження..."}):f?e.jsx("p",{className:"error-message",children:"Дошка не знайдена."}):e.jsxs(e.Fragment,{children:[e.jsx("h1",{children:o}),e.jsx("div",{className:"lists-container",children:i.map(t=>e.jsxs("div",{className:"list-container",children:[b===t.id?e.jsxs(e.Fragment,{children:[e.jsx("input",{type:"text",value:p,onChange:v=>c(v.target.value),className:"edit-input"}),e.jsx("button",{onClick:()=>S(t.id),children:"Зберегти"})]}):e.jsx("h3",{onClick:()=>N(t.id,t.title),children:t.title}),t.cards.map(v=>e.jsx(A,{card:v,fetchBoardData:m,boardId:s,listId:t.id},v.id)),e.jsx(_,{boardId:parseInt(s),listId:t.id,fetchBoardData:m})]},t.id))}),e.jsx(E,{onAddList:r})]})})},z=()=>{const{board_id:s}=T();return s?e.jsx("div",{children:e.jsx(D,{boardId:s})}):e.jsx("p",{children:"Помилка: `board_id` не знайдено"})};export{z as default};
